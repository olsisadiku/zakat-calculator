---
const currentPath = Astro.url.pathname;
const isGuide = currentPath.startsWith("/guide");

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/guide", label: "Guide" },
  { href: "/calculator", label: "Calculator" },
];
---

<header
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  id="main-header"
>
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-3 group">
      <div class="w-9 h-9 relative">
        <svg viewBox="0 0 64 64" class="w-full h-full">
          <defs>
            <linearGradient id="logo-g" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#2d6a4f" />
              <stop offset="100%" stop-color="#13291d" />
            </linearGradient>
          </defs>
          <rect width="64" height="64" rx="12" fill="url(#logo-g)" />
          <g
            transform="translate(32,32)"
            fill="none"
            stroke="#d4a843"
            stroke-width="1.5"
          >
            <rect x="-14" y="-14" width="28" height="28" rx="1"></rect>
            <rect
              x="-14"
              y="-14"
              width="28"
              height="28"
              rx="1"
              transform="rotate(45)"></rect>
          </g>
          <text
            x="32"
            y="38"
            text-anchor="middle"
            font-family="Georgia,serif"
            font-size="16"
            font-weight="bold"
            fill="#d4a843">Z</text
          >
        </svg>
      </div>
      <span
        class="font-display text-xl font-semibold text-forest-800 group-hover:text-gold transition-colors"
      >
        Zakat Guide
      </span>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex items-center gap-1">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              "font-ui text-sm font-medium px-4 py-2 rounded-sm transition-all duration-200",
              currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
                ? "text-forest-600 bg-forest-50"
                : "text-ink-light hover:text-forest-600 hover:bg-forest-50/50",
            ]}
          >
            {link.label}
          </a>
        ))
      }
    </nav>

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden p-2 text-ink-light hover:text-forest-600 transition-colors"
      aria-label="Toggle menu"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          id="menu-icon"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <!-- Mobile Nav -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-parchment-300/50 bg-parchment-100 shadow-lg"
  >
    <nav class="px-6 py-4 flex flex-col gap-1">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              "font-ui text-sm font-medium px-4 py-3 rounded-sm transition-all duration-200",
              currentPath === link.href || (link.href !== "/" && currentPath.startsWith(link.href))
                ? "text-forest-600 bg-forest-50"
                : "text-ink-light hover:text-forest-600 hover:bg-forest-50/50",
            ]}
          >
            {link.label}
          </a>
        ))
      }
    </nav>
  </div>
</header>

<!-- Spacer to prevent content from going under fixed header -->
<div class="h-16"></div>

<script>
  // Header scroll effect
  const header = document.getElementById("main-header");
  let lastScroll = 0;

  window.addEventListener("scroll", () => {
    const scroll = window.scrollY;
    if (header) {
      if (scroll > 20) {
        header.classList.add(
          "bg-parchment-100/95",
          "backdrop-blur-md",
          "shadow-sm"
        );
      } else {
        header.classList.remove(
          "bg-parchment-100/95",
          "backdrop-blur-md",
          "shadow-sm"
        );
      }
    }
    lastScroll = scroll;
  });

  // Mobile menu toggle
  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");

  menuBtn?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
    const isOpen = !mobileMenu?.classList.contains("hidden");
    if (isOpen) {
      header?.classList.add("bg-parchment-100", "shadow-lg");
    } else if (window.scrollY <= 20) {
      header?.classList.remove("bg-parchment-100", "shadow-lg", "bg-parchment-100/95", "backdrop-blur-md", "shadow-sm");
    }
  });
</script>
